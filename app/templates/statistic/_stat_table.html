{% if matrix %}
  <table border="1" cellspacing="0" cellpadding="4">
    {% for row in matrix %}
      <tr>
        {% for cell in row %}
          {% if heatmap %}
            <td data-alpha="{{ cell }}">
              {{ (cell * 100) | round(1) }}%
            </td>
          {% else %}
            {% if cell == 0 %}  
              <td> 0 </td>
            {% elif cell == 1 %}
              <td> 1 </td>
            {% elif cell == 2 %}
              <td> x </td>
            {% elif cell == 3 %}
              <td> ~ </td>
            {% elif cell == 4 %}
              <td> . </td>
            {% endif %}
          {% endif %}
        {% endfor %}
      </tr>
    {% endfor %}
  </table>
{% else %}
  <p>Chưa có dữ liệu hiển thị.</p>
{% endif %}



{# Hiện màu đẹp hơn, nhưng đừng hỏi làm thế nào ạ#}
<script>
const cells = document.querySelectorAll('td[data-alpha]');
if (cells.length > 0) {
  const values = Array.from(cells).map(td => parseFloat(td.dataset.alpha));
  const minA = Math.min(...values);
  const maxA = Math.max(...values);

  cells.forEach(td => {
    let val = parseFloat(td.dataset.alpha);
    let norm = (val - minA) / (maxA - minA); // chuẩn hóa 0–1

    // Nếu tất cả giá trị bằng nhau (tránh chia 0)
    if (isNaN(norm)) norm = 0.5;

    // Gradient từ xanh (thấp) → đỏ (cao)
    const r = Math.round(255 * norm);
    const g = Math.round(255 * (1 - norm));
    const b = Math.round(100 * (1 - norm));
    td.style.backgroundColor = `rgba(${r},${g},${b},0.8)`;

    // Nếu giá trị = 0 thì tô nhạt hơn một chút
    if (val === 0) td.style.backgroundColor = "rgba(220,220,220,0.4)";
  });
}
</script>